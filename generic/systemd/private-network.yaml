rules:
- id: private-network
  patterns:
    - pattern: |
        [Service]
        ...
        ...
        ...
    - pattern-not: |
        [Service]
        ...
        ...
        ...
        PrivateNetwork=true
    - pattern-not: |
        [Service]
        ...
        ...
        ...
        [$ANY]
        ...
        ...
        ...
        PrivateNetwork=true
  paths:
    include:
      - "*.service"
  metadata:
    references:
    - https://www.freedesktop.org/software/systemd/man/systemd.exec.html#PrivateNetwork=
    - https://www.ctrl.blog/entry/systemd-service-hardening.html
    - https://www.ctrl.blog/entry/systemd-opensmtpd-hardening.html
    - https://github.com/systemd/systemd/blob/main/src/analyze/analyze-security.c
    - https://www.shellhacks.com/systemd-service-file-example/
  message: Found systemd service missing PrivateNetwork
  languages: [generic]
  severity: ERROR
